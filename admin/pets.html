<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hayvonlar - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen">
    <aside class="fixed left-0 top-0 h-full w-64 bg-gray-900 text-white">
        <div class="p-6">
            <div class="flex items-center gap-3 mb-8"><span class="text-3xl">üêæ</span><span
                    class="text-xl font-bold">Pet Admin</span></div>
            <nav class="space-y-2">
                <a href="index.html" class="flex items-center gap-3 px-4 py-3 hover:bg-gray-800 rounded-xl">üìä
                    Dashboard</a>
                <a href="users.html" class="flex items-center gap-3 px-4 py-3 hover:bg-gray-800 rounded-xl">üë•
                    Foydalanuvchilar</a>
                <a href="pets.html" class="flex items-center gap-3 px-4 py-3 bg-orange-500 rounded-xl">üêï Hayvonlar</a>
                <a href="clinics.html" class="flex items-center gap-3 px-4 py-3 hover:bg-gray-800 rounded-xl">üè•
                    Klinikalar</a>
                <a href="donations.html" class="flex items-center gap-3 px-4 py-3 hover:bg-gray-800 rounded-xl">‚ù§Ô∏è
                    Xayriyalar</a>
            </nav>
        </div>
    </aside>

    <main class="ml-64 p-8">
        <div class="flex items-center justify-between mb-8">
            <h1 class="text-3xl font-bold">üêï Hayvonlar</h1>
            <div class="flex gap-4">
                <select id="statusFilter" class="px-4 py-2 border rounded-xl" onchange="loadPets()">
                    <option value="all">Barchasi</option>
                    <option value="pending">Kutilmoqda</option>
                    <option value="approved">Tasdiqlangan</option>
                </select>
                <input type="text" id="searchInput" placeholder="Qidirish..." class="px-4 py-2 border rounded-xl w-64"
                    oninput="searchPets()">
            </div>
        </div>

        <!-- Pending Section -->
        <div id="pendingSection" class="mb-8">
            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <span class="w-2 h-2 bg-yellow-500 rounded-full animate-pulse"></span>
                Tasdiq kutayotganlar (<span id="pendingCount">0</span>)
            </h2>
            <div id="pendingPets" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </div>

        <!-- All Pets -->
        <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
            <table class="w-full">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-4 text-left text-sm font-medium text-gray-500">Hayvon</th>
                        <th class="px-6 py-4 text-left text-sm font-medium text-gray-500">Turi</th>
                        <th class="px-6 py-4 text-left text-sm font-medium text-gray-500">Narxi</th>
                        <th class="px-6 py-4 text-left text-sm font-medium text-gray-500">Status</th>
                        <th class="px-6 py-4 text-left text-sm font-medium text-gray-500">Egasi</th>
                        <th class="px-6 py-4 text-left text-sm font-medium text-gray-500">Amallar</th>
                    </tr>
                </thead>
                <tbody id="petsTable" class="divide-y"></tbody>
            </table>
        </div>
    </main>

    <script src="../js/main.js"></script>
    <script>
        let pets = [];

        document.addEventListener('DOMContentLoaded', loadPets);

        async function loadPets() {
            try {
                const res = await fetch(`${API_BASE}/api/pets/all`, {
                    headers: { 'Authorization': `Bearer ${getToken()}` }
                });
                if (res.ok) {
                    const data = await res.json();
                    pets = data.pets;
                }
            } catch (e) {
                pets = getDemoPets();
            }
            displayPets();
        }

        function displayPets() {
            const filter = document.getElementById('statusFilter').value;
            let filtered = pets;
            if (filter === 'pending') filtered = pets.filter(p => !p.approved);
            else if (filter === 'approved') filtered = pets.filter(p => p.approved);

            const pending = pets.filter(p => !p.approved);
            document.getElementById('pendingCount').textContent = pending.length;
            document.getElementById('pendingPets').innerHTML = pending.slice(0, 6).map(p => `
                <div class="bg-white p-4 rounded-xl shadow-sm border flex justify-between items-center">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center text-xl">${getEmoji(p.pet_type)}</div>
                        <div><div class="font-medium">${p.name}</div><div class="text-sm text-gray-500">${p.pet_type}</div></div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="approvePet(${p.id})" class="px-3 py-1 bg-green-500 text-white rounded-lg text-sm">‚úì Tasdiqlash</button>
                        <button onclick="rejectPet(${p.id})" class="px-3 py-1 bg-red-500 text-white rounded-lg text-sm">‚úï</button>
                    </div>
                </div>
            `).join('') || '<p class="text-gray-400 col-span-full">Kutilayotgan e\'lonlar yo\'q</p>';

            document.getElementById('petsTable').innerHTML = filtered.map(p => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center text-xl">${getEmoji(p.pet_type)}</div>
                            <div class="font-medium">${p.name}</div>
                        </div>
                    </td>
                    <td class="px-6 py-4">${p.pet_type}</td>
                    <td class="px-6 py-4 font-medium">${p.price > 0 ? formatPrice(p.price) : 'Bepul'}</td>
                    <td class="px-6 py-4">
                        <span class="px-3 py-1 rounded-full text-xs font-medium ${p.approved ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}">${p.approved ? 'Tasdiqlangan' : 'Kutilmoqda'}</span>
                    </td>
                    <td class="px-6 py-4 text-gray-500">${p.owner_name || 'Noma\'lum'}</td>
                    <td class="px-6 py-4">
                        <div class="flex gap-2">
                            ${!p.approved ? `<button onclick="approvePet(${p.id})" class="px-2 py-1 bg-green-500 text-white rounded text-sm">‚úì</button>` : ''}
                            <button onclick="deletePet(${p.id})" class="px-2 py-1 bg-red-500 text-white rounded text-sm">O'chirish</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function searchPets() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const filtered = pets.filter(p => p.name.toLowerCase().includes(q));
            document.getElementById('petsTable').innerHTML = filtered.map(p => `
                <tr><td class="px-6 py-4">${p.name}</td><td class="px-6 py-4">${p.pet_type}</td><td class="px-6 py-4">${formatPrice(p.price)}</td><td class="px-6 py-4">${p.approved ? 'Tasdiqlangan' : 'Kutilmoqda'}</td><td class="px-6 py-4">${p.owner_name || '-'}</td><td class="px-6 py-4">-</td></tr>
            `).join('');
        }

        async function approvePet(id) { await fetch(`${API_BASE}/api/pets/${id}/approve`, { method: 'POST', headers: { 'Authorization': `Bearer ${getToken()}` } }); loadPets(); }
        async function rejectPet(id) { await fetch(`${API_BASE}/api/pets/${id}/reject`, { method: 'POST', headers: { 'Authorization': `Bearer ${getToken()}` } }); loadPets(); }
        async function deletePet(id) { if (confirm("O'chirishni tasdiqlaysizmi?")) { await fetch(`${API_BASE}/api/pets/${id}`, { method: 'DELETE', headers: { 'Authorization': `Bearer ${getToken()}` } }); loadPets(); } }

        function getEmoji(type) { return { dog: 'üêï', cat: 'üêà', bird: 'ü¶ú', fish: 'üê†' }[type] || 'üêæ'; }

        function getDemoPets() {
            return [
                { id: 1, name: 'Charlie', pet_type: 'dog', price: 3500000, approved: false, owner_name: 'Sardor' },
                { id: 2, name: 'Luna', pet_type: 'cat', price: 0, approved: true, owner_name: 'Malika' },
                { id: 3, name: 'Max', pet_type: 'dog', price: 2000000, approved: true, owner_name: 'Jasur' },
                { id: 4, name: 'Rio', pet_type: 'bird', price: 500000, approved: false, owner_name: 'Aziz' }
            ];
        }
    </script>
</body>

</html>